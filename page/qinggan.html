<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>情感标注</title>
    <link href="../layui/css/layui.css" rel="stylesheet">
    <style>
        body{padding: 6px 16px;}
        .demo-carousel{height: 200px; line-height: 200px; text-align: center;}
        .layui-table-cell {
            height: auto;
            line-height: 70px;
        }
    </style>
</head>
<body>

<div style="margin:20px">
    <h1><strong>情感标注</strong></h1>
    <table class="layui-hide" id="test" lay-filter="test"></table>
</div>





<div class="editDiv" style="display:none;">
    <form id="form1" class="layui-form layui-form-pane" action="" style="text-align:center">
    <div class="layui-form-item">
        <label class="layui-form-label">情感分类</label>
        <div class="layui-input-block">
            <input type="radio" name="tag" value="1" title="积极" checked="">
            <input type="radio" name="tag" value="0" title="正常">
            <input type="radio" name="tag" value="-1" title="消极">
            <input type="radio" name="tag" value="2" title="不确定">
        </div>
<!--        <div class="layui-form-item" style="margin: 15px auto;">-->
<!--            <div class="layui-input-block" style="text-align:center;">-->
<!--                <button type="submit" class="layui-btn" lay-filter="demo1" onclick="submit()">立即提交</button>-->
<!--            </div>-->
<!--        </div>-->
    </div>
    </form>
</div>


<script type="text/html" id="tableLastTd">
    <a class="layui-btn layui-btn-xs" lay-event="edit">标注</a>
<!--    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>-->
</script>

<script src="../js/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery.form/4.2.1/jquery.form.js"></script>
<script src="../layui/layui.js"></script>
<script>
    function submit() {
        alert("ok")
        var xx = $('input[name="tag"]:checked').val()
        alert(xx)
    }
    // var data = [];
    // $.ajax({
    //     type:'post',
    //     url:'/getinfo',
    //     data:{
    //         limit: 5,
    //         page: 1
    //     },
    //     dataType : "json",
    //     async:true,
    //     success : function(result) {
    //         if(result){
    //             console.log("result = " + JSON.stringify(result))
    //             data = JSON.stringify(result)
    //             // tableDrawing(data) // 数据传到 table组件
    //             // pagesDrawing(result) // 数据传到 分页组件
    //         }else{
    //             console.log(result);
    //         }
    //     },error : function() {
    //         console.log('访问失败');
    //     }
    // });
    //
    // function tableDrawing(data) {
        layui.use(['table', 'util'], function () {
            var table = layui.table;
            var util = layui.util;

            //展示已知数据
            table.render({
                elem: '#test',
                url: '/getinfo',
                cols: [
                    [ //标题栏
                        {field: 'id', title: 'ID', width: 60, sort: true}
                        , {field: 'content', title: '文本内容', minWidth: 200}
                        , {field: 'set', title: '操作', templet: "#tableLastTd", width: 80}
                        , {field: 'actor1Name', title: '对象1', width: 100}
                        , {field: 'actor2Name', title: '对象2', width: 100}
                        , {field: 'attitudeTag', title: '情感分类', width: 100}
                        , {field: 'time', title: '时间', width: 100, sort: true}
                        , {field: 'mentionIdentifier', title: 'url', minWidth: 100}
                        , {field: 'avgTone', title: 'avgTone', width: 90}
                        , {field: 'globalEventID', title: '事件id', width: 120}
                    ]
                ]
                , even: true
                , page: true //是否显示分页
                , limits: [5, 10, 100, 500]
                , limit: 5 //每页默认显示的数量
                // , done: function(res, curr, count){
                //     //如果是异步请求数据方式，res即为你接口返回的信息。
                //     //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
                //     console.log(res);
                //     //得到当前页码
                //     console.log(curr);
                //     //得到数据总量
                //     console.log(count);
                // }
            });

            table.on('tool(test)', function (obj) {

                if (obj.event === 'del') {
                    layer.confirm('确定要删除该条数据吗', function (index) {
                        layer.msg("正在删除啦....", {icon: 1, time: 1000});
                        return;
                    });
                } else if (obj.event === "edit") {
                    // console.log(JSON.stringify(obj.data))
                    layer.open({
                        title: '对当前文本内容选择情感分类',
                        type: 1,
                        move: false,
                        content: $('.editDiv'),
                        btn: ['提交', '取消'],
                        area: ['90%', '85%'],
                        resize: false,
                        scrollbar: false,
                        yes: function(index, layero){
                            var xx = $('input[name="tag"]:checked').val()
                            var iidd = obj.data.id
                            var glid = obj.data.globalEventID
                            // alert(xx + " + " + iidd + " " + glid + " --- ")
                            $.ajax({
                                    type:'post',
                                    url:'/updateInfo',
                                    data:{
                                        id: iidd,
                                        globalEventID: glid,
                                        attitudeTag: xx
                                    },
                                    dataType:'text',
                                    async:true,
                                    success : function(result) {
                                        layer.alert("添加成功");
                                        table.reloadData('test');
                                    },error : function() {
                                        console.log('访问失败');
                                    }
                                });

                            layer.close(index);
                        },
                        // yes: function (layIndex) {
                        //     $('#form1').ajaxSubmit({
                        //         success: function (rsp) {
                        //             if (rsp && rsp.success === true) {
                        //                 layer.close(layIndex);
                        //                 var oldData = layui.table.cache.tblInfo;
                        //                 var len = oldData.length;
                        //                 //循环数据，找到更新的数据行，直接更新
                        //                 for (var i = 0; i < len; i++) {
                        //                     if (oldData[i].P_NO == rsp.data.P_NO) {
                        //                         oldData[i] = rsp.data;
                        //                         break;
                        //                     }
                        //                 }
                        //                 //重新加一下数据
                        //                 layui.table.reload('tblInfo', { data: oldData });
                        //                 layer.msg('提交成功');
                        //             }
                        //             else {
                        //                 if (rsp && rsp.message) {
                        //                     layer.alert(rsp.message);
                        //                 }
                        //                 else {
                        //                     layer.alert('提交失败');
                        //                 }
                        //             }
                        //         }
                        //     });
                        // }
                    });
                }

            })


        });

</script>


</body>
</html>
